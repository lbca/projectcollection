/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},SetPhoneVcode=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),phone:"",sphone:"",downTime:60,operate:"",uiqcd:"",msg:{m1:"请输入验证码",m2:"验证码不正确，请重新输入",m3:"短信验证码已超时，请重新获取",m4:"手机号已存在，不可重复绑定",m5:"验证码发送已达当日上限",m6:"您当前的请求太频繁，休息一下5分钟后再尝试",m7:"短信验证码，发送手机号有误",m8:"验证短信发送失败",m9:"手机号绑定成功"},requestState:{sendCode:!0,save:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(SetPhoneVcode.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this,e=t.options.hrefParma,o=e.phone||"",i=e.sphone||o;t.options.phone=o,t.options.sphone=i,t.options.operate=e.operate||""},countDown:function(){var t=this;util.countDown({elem:$("#sendCode"),downTime:t.options.downTime,formate:"已发（count）",callback:function(){t.options.requestState.sendCode=!0}})},sendCode:function(t){var e,o,i=this;if(!i.options.requestState.sendCode)return!1;$("#sendCode");util.api({surl:root.CM_API_PATH+"getvm",data:{sphone:t},type:"post",beforeSend:function(){i.options.requestState.sendCode=!1},success:function(t){switch(e=t.rpco,o=t.body||{},e){case 200:i.countDown(),i.options.uiqcd=o.uiqcd;break;case 40002:util.tip(i.options.msg.m6);break;case 40001:util.tip(i.options.msg.m5);break;default:util.tip(i.options.msg.m8)}},complete:function(){200!==e&&(i.options.requestState.sendCode=!0)}})},_save:function(t,e,o,i){var n=this;util.api({surl:root.MB_API_PATH+"modmobile",data:{mobile:t,mac:e,uiqcd:o,state:i},type:"post",beforeSend:function(){n.options.requestState.save=!1},success:function(e){var o=e.rpco;switch(o){case 200:util.href("setphonefinish.html",{phone:t});break;case 40001:util.tip(n.options.msg.m2);break;case 40002:util.tip(n.options.msg.m3);break;case 40003:util.tip(n.options.msg.m4);break;default:util.tip("保存失败")}},complete:function(){n.options.requestState.save=!0}})},save:function(){var t=this,e=t.options.phone,o=$("#vcode").val(),i="";if(!t.options.requestState.save)return!1;if(!e)return util.tip(t.options.msg.m7),!1;if(!o)return util.tip(t.options.msg.m1),!1;switch(t.options.operate){case"add":case"mod":i=util.OPT_STATE.UPDATE;break;case"del":i=util.OPT_STATE.DELETE}t._save(e,o,t.options.uiqcd,i)},addEvent:function(){var t=this,e=util.getClick();t.options.hrefParma;t.el.on(e,"#sendCode",function(){var e=t.options.sphone;return!!t.options.requestState.sendCode&&(e?void t.sendCode(e):(util.tip(t.options.msg.m7),!1))}),t.el.on(e,"#nextStep",function(){t.save()}),t.el.on("input propertychange","#vcode",function(t){var e=$(this).val().replace(/[^0-9]/g,"");$(this).val(e)})}});