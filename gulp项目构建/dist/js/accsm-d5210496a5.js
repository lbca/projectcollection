/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},AccSm=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),ACTYPE:{1:"国美会员卡",2:"永乐会员卡",3:"大中会员卡",5:"库巴卡",6:"极信国美卡",7:"极信大中卡",8:"极信永乐卡"},actic:{1:"i-gomecard",2:"i-yonglecard",3:"i-dazhongcard",4:"i-gomecard",5:"i-gomecard",6:"i-gomecard",7:"i-gomecard",8:"i-gomecard"},actype:0,acnum:"",mcpnt:0,uiqcd:0,ivtid:0,msg:{m4:"该会员卡未绑定手机号",m5:"不存在此会员卡",m6:"会员卡类型下无此卡",m7:"验证码发送量已达今日上限",m8:"您当前的请求太频繁，休息一下5分钟后再尝试",m10:"请输入短信验证码",m11:"请发送验证码进行短信验证",m12:"短信验证码有误，请重新获取",m13:"短信验证码已超时，请重新获取",m14:"手机号有误，请重新尝试",m15:"会员卡已存在，不能重复绑定"},requestState:{getSendCodePhone:!0,save:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(AccSm.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this,e=t.options.hrefParma;e.tk&&t.getAccDetail(e.tk)},countDown:function(){var t=this;util.countDown({elem:$(".js-vcode"),downTime:t.options.downTime,formate:"已发（count）",callback:function(){t.options.requestState.getSendCodePhone=!0}})},getAccDetail:function(t){var e=this;util.api({surl:root.BSNS_API_PATH+"tkbdacc",data:{tk:t},type:"get",success:function(t){var o,i=t.rpco;switch(i){case 200:o=t.body||{},e.options.mcpnt=o.mcpnt,e.options.actype=o.actype,e.options.acnum=o.acnum,e.options.ivtid=o.ivtid,e.renderAccDetail(o);break;default:util.tip("查询失败")}}})},renderAccDetail:function(t){var e=this,o=e.options.ACTYPE[t.actype]||"";switch(o&&$("#acctype").html(o),$("#acctypetu").addClass(e.options.actic[t.actype]),t.acnum&&$("#acnum").html(t.acnum),t.mcpnt){case 1:case 3:t.empn&&$("#cardPhone").html(t.empn),$("#hasCardPhone").show();break;case 2:t.empn&&$("#userPhone").val(t.empn),$("#hasUserPhone").show(),$(".dialog").removeClass("dn");break;case 4:$("#unhave").show()}},getSendCodePhone:function(t,e,o){var i,n=this;util.api({surl:root.MB_API_PATH+"acbdph",data:{actype:t,acnum:e,mcpnt:o},type:"post",async:!1,beforeSend:function(){n.options.requestState.getSendCodePhone=!1},success:function(t){var e;switch(i=t.rpco){case 200:e=t.body||{},n.options.uiqcd=e.uiqcd,n.countDown();break;case 40001:util.tip(n.options.msg.m4);break;case 40002:util.tip(n.options.msg.m5);break;case 40003:util.tip(n.options.msg.m6);break;case 40004:util.tip(n.options.msg.m7);break;case 40005:util.tip(n.options.msg.m8);break;default:util.tip("请求失败")}},complete:function(){200!==i&&(n.options.requestState.getSendCodePhone=!0)}})},_save:function(t){var e=this;t.state=util.OPT_STATE.UPDATE,util.api({surl:root.MB_API_PATH+"modacc",data:t,type:"post",beforeSend:function(){e.options.requestState.save=!1},success:function(t){var o=t.rpco,i=t.body||{};i.uiqcd;switch(o){case 200:util.href("accsuccess.html");break;case 40001:util.tip(e.options.msg.m12);break;case 40002:util.tip(e.options.msg.m13);break;case 40003:util.tip(e.options.msg.m14);break;case 40004:util.tip(e.options.msg.m15);break;default:util.tip("保存失败")}},complete:function(){e.options.requestState.save=!0}})},save:function(){var t=this,e=$(".js-mac:visible").val();return t.options.uiqcd?e?void(t.options.requestState.save&&t._save({actype:t.options.actype,acnum:t.options.acnum,mac:e,uiqcd:t.options.uiqcd,ivtid:t.options.ivtid})):(util.tip(t.options.msg.m10),!1):(util.tip(t.options.msg.m11),!1)},addEvent:function(){var t=this,e=util.getClick();t.options.hrefParma;t.el.on(e,".js-vcode",function(){t.options.requestState.getSendCodePhone&&t.getSendCodePhone(t.options.actype,t.options.acnum,t.options.mcpnt)}),t.el.on(e,".js-save:visible",function(){t.save()}),t.el.on(e,"#dialogClose",function(){$(".dialog").addClass("dn")})}});