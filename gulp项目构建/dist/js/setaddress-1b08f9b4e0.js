/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},SetAddress=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),phoneReg:/^(((1[3|8][0-9])|(14[5|7])|(15[^4,\D])|(17[6|7|8]))\d{8}|(170[0|5|9])\d{7})$/,cnameReg:/^[\u4e00-\u9fa5a-zA-Z]+$/,addrReg:/^[^\s]+$/,address:{area:"",cname:"",cphone:"",addr:"",hnum:"",tsup:"",state:1},msg:{m1:"联系人姓名不能为空",m2:"联系电话不能为空",m3:"区域信息有误请重新选择",m4:"社区地址不能为空",m5:"门牌号不能为空",m6:"跳转页面，将失去当前录入的信息",m7:"请输入正确的手机号",m8:"联系人只能包含汉字或字母",m9:"社区地址不能包含空格",m10:"社区地址只支持6~28个字符",m11:"常用地址超限，请删除部分地址后添加"},requestState:{save:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(SetAddress.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this,e=t.options.hrefParma,s=e.d||"";s&&(t.options.address.area=s,t.getRegion(s))},getRegion:function(t){var e=t.slice(0,2)+"0000",s=t.slice(0,4)+"00",o="";util.api({surl:root.PVC_API_PATH+e+".json",type:"get",success:function(e){for(var i=e.cld||[],n=[],a={},r=0,p=i.length;r<p;r++)if(a=i[r]||{},s==a.C){o+=" "+a.N,n=a.cld;for(var r=0,p=n.length;r<p;r++)if(a=n[r]||{},t==a.C){o=a.F;break}break}$("#region").html(o)}})},_save:function(t){var e=this;util.api({surl:root.MB_API_PATH+"modaddr",data:t,type:"post",beforeSend:function(){e.options.requestState.save=!1},success:function(t){var s=t.rpco;t.body||{};switch(s){case 200:util.href("addresslist.html");break;case 40006:util.tip(e.options.msg.m11);break;default:util.tip("保存失败")}},complete:function(){e.options.requestState.save=!0}})},save:function(){var t=this,e=t.options.address.tsup,s=t.options.address.area,o=$("#cname").val(),i=$("#cphone").val(),n=$("#addr").val(),a=$("#hnum").val();return!!t.options.requestState.save&&(o?t.options.cnameReg.test(o)?i?t.options.phoneReg.test(i)?s?n?n.length<6||n.length>28?(util.tip(t.options.msg.m10),!1):t.options.addrReg.test(n)?a?($.extend(t.options.address,{tsup:e,area:s,cname:o,cphone:i,addr:n,hnum:a,state:util.OPT_STATE.UPDATE}),t.options.address.tsup||delete t.options.address.tsup,void t._save(t.options.address)):(util.tip(t.options.msg.m5),!1):(util.tip(t.options.msg.m9),!1):(util.tip(t.options.msg.m4),!1):(util.tip(t.options.msg.m3),!1):(util.tip(t.options.msg.m7),!1):(util.tip(t.options.msg.m2),!1):(util.tip(t.options.msg.m8),!1):(util.tip(t.options.msg.m1),!1))},addEvent:function(){var t=this,e=util.getClick();t.options.hrefParma;t.el.on(e,"#save",function(){t.save()}),t.el.on("input propertychange","#cphone",function(t){var e=$(this).val().replace(/[^0-9]/g,"");$(this).val(e)}),t.el.on(e,"#region",function(){util.alert(t.options.msg.m6,{justOk:!1,defBtnIndex:1,okFn:function(){util.href("areaprovince.html",{cbu:"setaddress.html"})}})})}});