/**
 * yidao
 * created by 用车前端组
 */
"use strict";!function(t,e){function i(t,e){var i=t,s=e;return(n.transform3d?"translate3d("+i+"px, "+s+"px, 0)":"translate("+i+"px, "+s+"px)")+" scale("+a+")"}function s(t,e){return n.touch?t.changedTouches[0][e]:t[e]}var o=t.document,n={transform3d:"WebKitCSSMatrix"in t&&"m11"in new WebKitCSSMatrix,touch:"ontouchstart"in t},a=1,r=function(){};r.prototype={init:function(t){var e=this,i=t||{},s=o.querySelectorAll(i.elem+" img"),n=o.querySelector(".imgzoom_pack"),r=o.querySelector(".imgzoom_pack .imgzoom_img img"),h=(o.querySelector(".imgzoom_pack .imgzoom_x"),"");e.buffMove=3,e.buffScale=2,e.finger=!1,e._destroy(),n.addEventListener("click",function(){n.style.cssText="display:none",r.src="",r.style.cssText="",e._destroy(),o.removeEventListener("touchmove",e.eventStop,!1)},!1);for(var d=s.length,m=0;m<d;m++)s[m].addEventListener("click",function(){h=this.getAttribute("src"),n.style.cssText="display:block",r.src=h,r.onload=function(){var t=0,i="";r.offsetWidth<n.offsetWidth&&(a=(r.offsetWidth/n.offsetWidth).toFixed(2)),i="visibility: visible;width: 100%;-webkit-transform: scale("+a+");",r.style.cssText=i,t=(n.offsetHeight-r.offsetHeight)/2,i+="margin-top:"+t+"px;",r.style.cssText=i,o.addEventListener("touchmove",e.eventStop,!1),e.imgBaseWidth=r.offsetWidth,e.imgBaseHeight=r.offsetHeight,e.addEventStart({wrapX:n.offsetWidth,wrapY:n.offsetHeight,mapX:r.width,mapY:r.height})}},!1)},addEventStart:function(t){var e=this,i=t||{};e.element=o.querySelector(".imgzoom_pack img"),e.wrapX=i.wrapX||0,e.wrapY=i.wrapY||0,e.mapX=i.mapX||0,e.mapY=i.mapY||0,e.outDistY=(e.mapY-e.wrapY)/2,e.width=e.mapX-e.wrapX,e.height=e.mapY-e.wrapY,e.element.addEventListener("touchstart",function(t){e._touchstart(t)},!1),e.element.addEventListener("touchmove",function(t){e._touchmove(t)},!1),e.element.addEventListener("touchend",function(t){e._touchend(t)},!1)},_destroy:function(){this.distX=0,this.distY=0,this.newX=0,this.newY=0},_changeData:function(){this.mapX=this.element.offsetWidth,this.mapY=this.element.offsetHeight,this.width=this.mapX-this.wrapX,this.height=this.mapY-this.wrapY},_touchstart:function(t){var e=this,i=t.targetTouches.length;e._changeData(),1==i?(e.basePageX=s(t,"pageX"),e.basePageY=s(t,"pageY"),e.finger=!1):(e.finger=!0,e.startFingerDist=e.getTouchDist(t).dist,e.startFingerX=e.getTouchDist(t).x,e.startFingerY=e.getTouchDist(t).y)},_touchmove:function(t){var e=this;t.preventDefault(),t.stopPropagation();var i=t.targetTouches.length;1!=i||e.finger||e._move(t),i>=2&&e._zoom(t)},_touchend:function(t){var e=this;e._changeData(),e.finger&&(e.distX=-e.imgNewX,e.distY=-e.imgNewY),e.distX>0?e.newX=0:e.distX<=0&&e.distX>=-e.width?(e.newX=e.distX,e.newY=e.distY):e.distX<-e.width&&(e.newX=-e.width),e.reset()},_move:function(t){var e=this,i=s(t,"pageX"),o=s(t,"pageY");e.distX=i-e.basePageX+e.newX,e.distY=o-e.basePageY+e.newY,e.distX>0?e.moveX=Math.round(e.distX/e.buffMove):e.distX<=0&&e.distX>=-e.width?e.moveX=e.distX:e.distX<-e.width&&(e.moveX=-e.width+Math.round((e.distX+e.width)/e.buffMove)),e.movePos(),e.finger=!1},_zoom:function(t){var e=this,i=e.getTouchDist(t).dist,s=i/e.startFingerDist,o=Math.round(e.mapX*s);Math.round(e.mapY*s);e.imgNewX=Math.round(e.startFingerX*s-e.startFingerX-e.newX*s),e.imgNewY=Math.round((e.startFingerY*s-e.startFingerY)/2-e.newY*s),o>=e.imgBaseWidth?(e.element.style.width=o+"px",e.refresh(-e.imgNewX,-e.imgNewY,"0s","ease"),e.finger=!0):o<e.imgBaseWidth&&(e.element.style.width=e.imgBaseWidth+"px"),e.finger=!0},movePos:function(){var t=this;if(t.height<0)if(t.element.offsetWidth==t.imgBaseWidth)t.moveY=Math.round(t.distY/t.buffMove);else{var e=Math.round((t.element.offsetHeight-t.imgBaseHeight)/2);t.moveY=-e+Math.round((t.distY+e)/t.buffMove)}else{var i=Math.round((t.wrapY-t.imgBaseHeight)/2),s=t.element.offsetHeight-t.wrapY+Math.round(t.wrapY-t.imgBaseHeight)/2;t.distY>=-i?t.moveY=Math.round((t.distY+i)/t.buffMove)-i:t.distY<=-s?t.moveY=Math.round((t.distY+s)/t.buffMove)-s:t.moveY=t.distY}t.refresh(t.moveX,t.moveY,"0s","ease")},reset:function(){var t=this,e=".2s";if(t.height<0)t.newY=-Math.round(t.element.offsetHeight-t.imgBaseHeight)/2;else{var i=Math.round((t.wrapY-t.imgBaseHeight)/2),s=t.element.offsetHeight-t.wrapY+Math.round(t.wrapY-t.imgBaseHeight)/2;t.distY>=-i?t.newY=-i:t.distY<=-s?t.newY=-s:t.newY=t.distY}t.refresh(t.newX,t.newY,e,"ease-in-out")},refresh:function(t,e,s,o){this.element.style.webkitTransitionProperty="-webkit-transform",this.element.style.webkitTransitionDuration=s,this.element.style.webkitTransitionTimingFunction=o,this.element.style.webkitTransform=i(t,e)},getTouchDist:function(t){var e=0,i=0,s=0,n=0,a=0,r=0,h={};if(e=t.touches[0].pageX,s=t.touches[1].pageX,i=t.touches[0].pageY-o.body.scrollTop,n=t.touches[1].pageY-o.body.scrollTop,e&&s)return a=e<=s?(s-e)/2+e:(e-s)/2+s,r=i<=n?(n-i)/2+i:(i-n)/2+n,h={dist:Math.round(Math.sqrt(Math.pow(e-s,2)+Math.pow(i-n,2))),x:Math.round(a),y:Math.round(r)}},eventStop:function(t){t.preventDefault(),t.stopPropagation()}},t.ImagesZoom=new r}(void 0);