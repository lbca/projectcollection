/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},AssetList=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),msg:{m1:"资产删除成功",m2:"是否删除当前资产？",m3:"资产编号有误",m4:"资产名称不能为空",m5:"保存成功"},requestState:{deleteAsset:!0},iScrollZoom:null},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(AssetList.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this;t.options.hrefParma;t.getAssetList()},getAssetList:function(){var t=this;util.api({surl:root.AS_API_PATH+"asslist",type:"get",success:function(s){var e=s.rpco,n=s.body||{},i=n.aslist||[];switch(e){case 200:t.renderAssetList(i),$(".js-btn-menu").show();break;case 404:$("#noList").show();break;default:util.tip("查询失败")}}})},renderAssetList:function(t){var s,e,t=t||[],n="",i="",a={1:'<span class="btn btn-linear" style="">维修</span>',2:'<span class="btn btn-linear" style="">回收</span>',3:'<span class="btn btn-linear" style="">清洗</span>',4:'<span class="btn btn-linear" style="">买延保</span>',5:'<span class="btn btn-linear" style="">安装</span>',6:'<span class="btn btn-linear" style="">配件</span>'},l="";$.each(t,function(t,o){switch(o.aswaew){case 1:case 2:s="在保",e="btn-ylw";break;case 3:case 4:s="过保",e="btn-gray";break;default:s="状态未知",e="btn-gray"}if(i="",o.svtplst)for(var t=0,r=o.svtplst.length;t<r&&!(t>2);t++)i+=a[o.svtplst[t]]||"";l=o.asname||"",n+='<ul class="list-text icon" val="'+o.asnum+'">    <li>        <img class="text-icon i " src="'+o.asimgu+'">        <input class="txt-ipt" type="text" orival="'+l+'" value="'+l+'" maxlength="35" readonly><span class="btn btn-red dn js-save" >保存</span>        <div class="txt-blk">            品牌：<span>'+(o.brdnm||"")+'</span>        </div>        <div class="txt-blk">            型号：<span>'+(o.mdnm||"")+'</span>        </div>        <div class="smlbtn-blk">            <span class="btn '+e+'">'+s+'</span>        </div>        <span class="btn-del dn"><i class="i i-delete1"></i></span>        <span class="btn-edt dn"><i class="i i-edit2"></i></span>    </li>    <li>'+i+"</li></ul>"}),n&&$("#list").html(n).show()},_deleteAsset:function(t){var s=this;util.api({surl:root.AS_API_PATH+"modass",data:{asnum:t,state:util.OPT_STATE.DELETE},type:"post",beforeSend:function(){s.options.requestState.deleteAsset=!1},success:function(t){var s=t.rpco;t.body||{};switch(s){case 200:window.location.reload();break;default:util.tip("删除失败")}},complete:function(){s.options.requestState.deleteAsset=!0}})},deleteAsset:function(t){var s=this;util.alert(s.options.msg.m2,{justOk:!1,defBtnIndex:1,okFn:function(){s._deleteAsset(t)}})},_saveAssetName:function(t,s){var e=this;util.api({surl:root.AS_API_PATH+"modass",data:{asnum:t,asname:s,state:util.OPT_STATE.UPDATE},type:"post",success:function(s){var n=s.rpco;switch(n){case 200:$('ul[val="'+t+'"] .txt-ipt').attr("readonly",!0),$('ul[val="'+t+'"] .btn-edt').show(),$('ul[val="'+t+'"] .js-save').hide(),util.tip(e.options.msg.m5);break;default:util.tip("保存失败")}}})},saveAssetName:function(t){var s=this,e=t.closest("ul"),n=e.attr("val"),i=e.find(".txt-ipt").val(),a=e.find(".txt-ipt").attr("orival");return n?i?i===a?(e.find(".txt-ipt").attr("readonly",!0),e.find(".btn-edt").show(),e.find(".js-save").hide(),util.tip(s.options.msg.m5),!1):void s._saveAssetName(n,i):(util.tip(s.options.msg.m4),!1):(util.tip(s.options.msg.m3),!1)},addEvent:function(){var t=this,s=util.getClick();t.options.hrefParma;t.el.on(s,".js-unBind",function(){$(".btn-del").show()}),t.el.on(s,".js-editName",function(){$(".btn-edt").show()}),$(".header, .container").on(s,function(t){var s=$(t.target);s.is(".btn-del, .btn-edt, .js-editName, .js-unBind")||($(".btn-del").hide(),0===$(".js-save:visible").length&&$(".btn-edt").hide())}),t.el.on(s,".btn-del, .i-delete1",function(s){t.deleteAsset($(this).closest("ul").attr("val"))}),t.el.on(s,".btn-edt",function(t){$(".js-save:visible").not($(this)).trigger(s);var e=$(this).closest("ul");e.find(".txt-ipt").removeAttr("readonly").focus(),$(this).hide(),e.find(".js-save").show()}),t.el.on(s,".list-text",function(){$(".js-save, .btn-del, .btn-edt").find(":visible").length>0||util.href("assetdetail.html",{asnum:$(this).attr("val")})}),t.el.on(s,".js-save",function(s){t.saveAssetName($(this))})}});