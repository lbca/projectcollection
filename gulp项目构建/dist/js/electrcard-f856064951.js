/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},ElectrCard=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),INT_REG:/^\d+$/,FLOAT_REG:/^\d+(\.\d+)?$/,DATE_REG:/^(19[7-9][0-9]|2\d{3})-([1-9]|0[1-9]|1[0-2])-([1-9]|[0-2][0-9]|3[0-1])$/,wcSuccess:!1,msg:{m1:"保存成功",m2:"请核对扫码内容"},requestState:{wcSuccess:!1,delAccount:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(ElectrCard.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this,a=t.options.hrefParma;a.asnum&&t.getElectrCard(a.asnum)},getElectrCard:function(t){var a=this;util.api({surl:root.AS_API_PATH+"awwcdtl",data:{asnum:t},type:"get",success:function(t){var e,s=t.rpco;switch(s){case 200:e=t.body||{},a.renderElectrCard(e);break;default:util.tip("查询失败")}}})},renderElectrCard:function(t){var a,e,s,i=this,l="";t.gdna&&$("#gdna").html(t.gdna),a=t.dotw-t.sctm,a=isNaN(a)?0:a,t.mfpn&&$("#mfpn").attr("href","tel:"+t.mfpn).html(t.mfpn),t.dotw?a>0?($("#dotw").html(parseInt(a/1e3/60/60/24)+1),$("#have").show()):a<0&&$("#nohave").show():$("#unknow").show(),t.wcbic=t.wcbic||[];for(var c=0,n=t.wcbic.length;c<n;c++){l+='<ul class="list-labelvalue">',t.wcbic[c].wcbicc=t.wcbic[c].wcbicc||[];for(var o=0,r=t.wcbic[c].wcbicc.length;o<r;o++){switch(e=t.wcbic[c].wcbicc[o],s=e.lbvl||"",e.dttp){case 93:s=parseInt(s),s=s>1?util.formateDate(s,"yyyy-MM-dd"):"";break;case 94:s&&(s=parseFloat(s/100).toFixed(2))}switch(e.optp){case 0:l+='<li lbid="'+e.lbid+'" optp="'+e.optp+'" dttp="'+e.dttp+'"><label>'+e.lbttl+'</label><span class="value">'+s+"</span><li>";break;case 10:l+='<li lbid="'+e.lbid+'" optp="'+e.optp+'" dttp="'+e.dttp+'"><label class="rd-st">'+e.lbttl+'</label><input class="value" placeholder="请输入'+e.lbttl+'" maxlength="64" value="'+s+'" orival="'+s+'"/><li>';break;case 11:l+='<li lbid="'+e.lbid+'" optp="'+e.optp+'" dttp="'+e.dttp+'"><label class="rd-st">'+e.lbttl+'</label><span class="btn-opct js-saoma"><i class="i i-saoma"></i></span><input class="value" placeholder="请输入'+e.lbttl+'" maxlength="64" value="'+s+'" orival="'+s+'"/><li>';break;case 12:}}l+="</ul>"}l&&$("#wcbic").html(l)&&i.setVlaueElWidth()},setVlaueElWidth:function(){$(".list-labelvalue .value").each(function(t,a){var e=$(this).closest("li"),s=e.find("label").width()+20,i=100-(s/e.width()*100).toFixed(2)+"%",l={width:i};e.find(".btn-opct").length>0&&(l["padding-right"]="40px"),$(this).css(l)})},showSaveButton:function(){$(".container").addClass("hsft"),$(".footer").show()},hideSaveButton:function(){$(".container").removeClass("hsft"),$(".footer").hide()},saoma:function(t){var a=this;a.options.wcSuccess&&wx.scanQRCode({needResult:1,scanType:["barCode"],success:function(e){var s=e.resultStr||"";s=s.replace(/.*,/,""),t.val(s),util.tip(a.options.msg.m2),a.showSaveButton()}})},_save:function(t){var a=this;util.api({surl:root.AS_API_PATH+"modawwc",data:t,type:"post",success:function(t){var e=t.rpco;switch(e){case 200:util.tip(a.options.msg.m1),a.hideSaveButton();break;default:util.tip("保存失败")}}})},checkDataType:function(){var t=this,a=!0;return $(".list-labelvalue input:visible").each(function(e,s){var i=$(this).closest("li"),l=i.find("label").html(),c=parseInt(i.attr("dttp")),n=$(this).val();switch(c){case 0:break;case 21:break;case 22:break;case 23:case 24:if(n&&!t.options.INT_REG.test(n))return a=!1,util.tip("“"+l+"”只能为整数哦~"),!1;break;case 25:case 26:case 94:if(n&&!t.options.FLOAT_REG.test(n))return a=!1,util.tip("“"+l+"”只能为小数哦~"),!1;break;case 33:break;case 54:break;case 93:if(n&&!t.options.DATE_REG.test(n))return a=!1,util.tip("“"+l+"”支持格式为“xxxx-xx-xx”"),!1}}),a},save:function(){var t=this,a={};return!!t.checkDataType()&&(a.asnum=t.options.hrefParma.asnum,a.wcbic=[],$(".list-labelvalue input:visible").each(function(t,e){var s=$(this).closest("li"),i=s.attr("lbid"),l=parseInt(s.attr("dttp")),c=$(this).val(),n=$(this).attr("orival");if(c==n)return!0;switch(l){case 93:c&&(c=new Date(c.replace(/-/g,"/")).getTime())}a.wcbic.push({lbid:i,lbvl:c})}),void(0===a.wcbic.length?(util.tip(t.options.msg.m1),t.hideSaveButton()):t._save(a)))},addEvent:function(){var t=this,a=util.getClick();t.options.hrefParma;t.el.on(a,"#bxkxz",function(){$(".dialog").removeClass("dn")}),t.el.on(a,"#dialogClose",function(){$(".dialog").addClass("dn")}),t.el.on("focus","input.value",function(){t.showSaveButton()}),t.el.on(a,".js-saoma",function(a){t.saoma($(this).closest("li").find("input.value"))}),t.el.on(a,"#save",function(){t.save()})}});