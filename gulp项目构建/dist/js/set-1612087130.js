/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},Set=function(e){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),sex:{0:"未设置",1:"女",2:"男"},userdtal:{},iScrollZoom:null,requestState:{changePwdOper:!0}},e),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(Set.prototype,{init:function(){var e=this;e.load(),e.addEvent()},load:function(){var e=this;e.getUserDetail()},renderUserDetail:function(e){var t=this,i=t.options.sex[e.sex]||"未设置";e.hporturl&&$("#headPort .userpic").attr("src",e.hporturl),e.nick&&$("#nickName .value").html(e.nick),e.mbsn&&$("#meiFuNum .value").html(e.mbsn),e.mobile&&$("#phoneNum .value").html(util.strEncrypt(e.mobile,3,4)),e.email&&$("#email .value").html(e.email),$("#sex .value").html(i),e.region&&$("#area .value").html(e.region),e.sign&&$("#signature .value").html(e.sign),e.mbsn&&$("#meiFuNum").attr("nocge",!0),e.mobile&&$("#phoneNum").attr("nocge",!0),e.email&&$("#email").attr("nocge",!0)},getUserDetail:function(){var e=this;util.api({surl:root.MB_API_PATH+"userdtal",type:"get",success:function(t){var i=t.rpco,s=t.body||{};switch(i){case 200:e.options.userdtal=s,e.renderUserDetail(s);break;default:util.tip("查询失败")}}})},changePwdOper:function(){var e=this;util.api({surl:root.MB_API_PATH+"checkpwd",type:"get",beforeSend:function(){e.options.requestState.changePwdOper=!1},success:function(e){var t=e.rpco,i=e.body||{},s=i.ispwd,a=i.mod,r="";switch(t){case 200:0===s&&1===a?r="setpwd.html":1===s&&1===a&&(r="setpwdmod.html"),r&&util.href(r);break;default:util.tip("服务器开会小差···")}}})},creatLink:function(){util.api({surl:root.BSNS_API_PATH+"getk",type:"get",success:function(e){var t,i=e.rpco;switch(i){case 200:t=e.body||{},t.tk&&util.href("invite.html",{tk:t.tk});break;default:util.tip("生成失败")}}})},switchOperate:function(e){var t=this,i={};switch(e){case"headPort":t.dlgimg($("#headPort img").get(0).src);break;case"nickName":t.options.userdtal.nick&&(i.nick=util.encode(t.options.userdtal.nick)),util.href("setnick.html",i);break;case"meiFuNum":t.options.userdtal.mbsn||util.href("setmeifunum.html");break;case"signature":t.options.userdtal.sign&&(i.sign=util.encode(t.options.userdtal.sign)),util.href("setsignature.html",i);break;case"phoneNum":t.options.userdtal.mbsn&&(i.mbsn=t.options.userdtal.mbsn),t.options.userdtal.mobile||util.href("setphone.html",i);break;case"address":util.href("addresslist.html");break;case"changePwd":t.options.requestState.changePwdOper&&t.changePwdOper();break;case"sex":t.options.userdtal.sex&&(i.sex=t.options.userdtal.sex),util.href("setsex.html",i);break;case"email":t.options.userdtal.email||util.href("setemail.html");break;case"papers":util.href("certificatelist.html");break;case"area":util.href("areaprovince.html",{b:"1"},!0);break;case"certifi":util.href("certificatelist.html");break;case"myshare":t.creatLink();break;case"kahaobd":util.href("acclist.html",{cbu:"javascript:window.history.back();"})}},dlgimg:function(e){var t=this,i="";$(".dialog-img").remove(),i='<div class="dialog-img"><div class="tablecell"><img src="'+e+'"></div></div>',$("body").append(i),t.options.iScrollZoom=new IScroll(".dialog-img",{zoom:!0,scrollX:!0})},addEvent:function(){var e=this,t=util.getClick();e.el.on(t,".container li",function(){e.switchOperate(this.id)}),e.el.on(t,".dialog-img",function(){e.options.iScrollZoom.destroy(),$(".dialog-img").remove()})}});