/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},AccList=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),ACTYPE:{1:"国美会员卡",2:"永乐会员卡",3:"大中会员卡",5:"库巴卡",6:"极信国美卡",7:"极信大中卡",8:"极信永乐卡"},actic:{1:"i-gomecard",2:"i-yonglecard",3:"i-dazhongcard",4:"i-gomecard",5:"i-gomecard",6:"i-gomecard",7:"i-gomecard",8:"i-gomecard"},aclist:[],msg:{m1:"账户删除成功",m2:"是否删除当前会员卡？"},requestState:{delAccount:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(AccList.prototype,{init:function(){var t=this;t.load(),t.addEvent(),t.loadGoBack()},load:function(){var t=this;t.options.hrefParma;t.getAccountList()},loadGoBack:function(){var t=this,c=t.options.hrefParma;c.cbu&&$(".goBack").attr("href","javascript:util.href('"+c.cbu+"');").show()},renderAccountList:function(t){var c=this,t=t||[],i="",n="",o="",e="",a="";$.each(t,function(t,s){n=s.actype||"",e=c.options.actic[n]||"&nbsp;",o=c.options.ACTYPE[n]||"&nbsp;",a=s.acnum||"&nbsp;",i+='<li actype="'+n+'" acnum="'+a+'"><i class="accicon i '+e+'"></i><p class="acctype">'+o+'</p><p class="acccode">会员卡</p><p class="accnum">'+a+'</p><span class="btn-del dn"></span><i class="i i-del dn"></i></li>'}),i&&$("#list ul").html(i)&&$("#list").show()},getAccountList:function(){var t=this;util.api({surl:root.MB_API_PATH+"acclist",type:"get",success:function(c){var i,n=c.rpco;switch(n){case 200:i=c.body||{},t.options.aclist=i.aclist,t.renderAccountList(i.aclist);break;case 404:$("#noList").show(),$("#js-unBind").hide();break;default:util.tip("查询失败")}}})},_delAccount:function(t,c){var i=this;util.api({surl:root.MB_API_PATH+"modacc",data:{acnum:t,actype:c,state:util.OPT_STATE.DELETE},type:"post",beforeSend:function(){i.options.requestState.delAccount=!1},success:function(t){var c=t.rpco;t.body||{};switch(c){case 200:window.location.reload();break;default:util.tip("删除失败")}},complete:function(){i.options.requestState.delAccount=!0}})},delAccount:function(t,c){var i=this;util.alert(i.options.msg.m2,{justOk:!1,defBtnIndex:1,okFn:function(){i._delAccount(t,c)}})},addEvent:function(){var t=this,c=util.getClick();t.options.hrefParma;t.el.on(c,".js-addBind",function(){util.href("acctype.html")}),t.el.on(c,".js-unBind",function(){$(".btn-del, .i-del").show()}),$(".header, .container").on(c,function(t){var c=$(t.target);c.is(".btn-del, .js-unBind")||$(".btn-del, .i-del").hide()}),t.el.on(c,".btn-del",function(){var c=$(this).closest("li"),i=c.attr("acnum")||"",n=c.attr("actype")||"";t.delAccount(i,n)})}});