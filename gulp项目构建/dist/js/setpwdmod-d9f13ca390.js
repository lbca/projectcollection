/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},SetPwdmod=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),uiqcd:"",pwdReg:/^[^\u4e00-\u9fa5\s]+$/,msg:{m1:"请输入原始密码",m2:"请输入新密码",m3:"请输入确认密码",m4:"新密码和确认密码输入不一致",m5:"请输入验证码",m6:"密码长度限制为6~18位",m7:"原始密码错误",m8:"验证码错误",m9:"修改次数已达今日上限",m10:"密码不能包含汉字或空格"},requestState:{save:!0,setVerCode:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(SetPwdmod.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this;t.options.hrefParma;t.setVerCode()},setVerCode:function(){var t=this,e=$("#vimg");return!!t.options.requestState.setVerCode&&void util.api({surl:root.CM_API_PATH+"getvc",type:"get",beforeSend:function(){t.options.requestState.setVerCode=!1},success:function(o){var i=o.rpco,s=o.body||{};switch(i){case 200:t.options.uiqcd=s.uiqcd,e.attr("src",s.vcode);break;default:util.tip("验证码获取失败")}},complete:function(){t.options.requestState.setVerCode=!0}})},_save:function(t,e,o){var i=this;util.api({surl:root.MB_API_PATH+"modupwd",data:{npwd:e,opwd:t,vcode:o,uiqcd:i.options.uiqcd},type:"post",beforeSend:function(){i.options.requestState.save=!1},success:function(t){var e=t.rpco;t.body||{};switch(e){case 200:util.href("set.html");break;case 40001:i.setVerCode(),util.tip(i.options.msg.m7);break;case 40002:i.setVerCode(),util.tip(i.options.msg.m8);break;case 40101:i.setVerCode(),util.tip(i.options.msg.m9);break;default:i.setVerCode(),util.tip("保存失败")}},complete:function(){i.options.requestState.save=!0}})},save:function(){var t=this,e=$("#oPwd").val(),o=$("#nPwd").val(),i=$("#cfmNPwd").val(),s=$("#vcode").val();return!!t.options.requestState.save&&(e?e.length<6||e.length>18?(util.tip(t.options.msg.m6),!1):o?t.options.pwdReg.test(o)?o.length<6||o.length>18?(util.tip(t.options.msg.m6),!1):i?i!=o?(util.tip(t.options.msg.m4),!1):s?void t._save(e,o,s):(util.tip(t.options.msg.m5),!1):(util.tip(t.options.msg.m3),!1):(util.tip(t.options.msg.m10),!1):(util.tip(t.options.msg.m2),!1):(util.tip(t.options.msg.m1),!1))},addEvent:function(){var t=this,e=util.getClick();t.options.hrefParma;t.el.on(e,"#save",function(){t.save()}),t.el.on(e,"#vimg",function(){t.setVerCode()})}});