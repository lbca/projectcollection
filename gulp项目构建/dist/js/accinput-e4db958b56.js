/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},AccInput=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),ACTYPE:{1:"国美会员卡",2:"永乐会员卡",3:"大中会员卡",5:"库巴卡",6:"极信国美卡",7:"极信大中卡",8:"极信永乐卡"},downTime:60,uiqcd:"",msg:{m1:"请选择会员卡类型",m2:"会员卡类型有误，请重新选择",m3:"请输入会员卡号",m4:"该会员卡未绑定手机号",m5:"不存在此会员卡",m6:"会员卡类型下，不存在该会员卡",m7:"验证码发送量已达今日上限",m8:"您当前的请求太频繁，休息一下5分钟后再尝试",m9:"请发送验证码进行短信验证",m10:"请输入短信验证码",m11:"短信验证码有误，请重新获取",m12:"短信验证码已超时，请重新获取",m13:"手机号有误，请重新尝试",m14:"会员卡已存在，不能重复绑定"},requestState:{getSendCodePhone:!0,save:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(AccInput.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this,e=t.options.hrefParma;e.acnum&&$("#acnum").val(e.acnum),e.actype&&$("#actype").html(t.options.ACTYPE[e.actype]||"")},countDown:function(){var t=this;util.countDown({elem:$("#sendCode"),downTime:t.options.downTime,formate:"已发（count）",callback:function(){t.options.requestState.getSendCodePhone=!0}})},getSendCodePhone:function(t,e){var s,n=this;util.api({surl:root.MB_API_PATH+"acbdph",data:{actype:t,acnum:e},type:"post",async:!1,beforeSend:function(){n.options.requestState.getSendCodePhone=!1},success:function(t){var e;switch(s=t.rpco){case 200:e=t.body||{},n.options.uiqcd=e.uiqcd,e.empn&&$("#mobile").html(e.empn)&&$("#sendTip").show(),n.countDown();break;case 40001:util.tip(n.options.msg.m4);break;case 40002:util.tip(n.options.msg.m5);break;case 40003:util.tip(n.options.msg.m6);break;case 40004:util.tip(n.options.msg.m7);break;case 40005:util.tip(n.options.msg.m8);break;default:util.tip("请求失败")}},complete:function(){200!==s&&(n.options.requestState.getSendCodePhone=!0)}})},sendCodeClick:function(){var t=this,e=t.options.hrefParma.actype,s=$("#acnum").val();return e?t.options.ACTYPE[e]?s?void(t.options.requestState.getSendCodePhone&&t.getSendCodePhone(e,s)):(util.tip(t.options.msg.m3),!1):(util.tip(t.options.msg.m2),!1):(util.tip(t.options.msg.m1),!1)},_save:function(t){var e=this;t.state=util.OPT_STATE.UPDATE,util.api({surl:root.MB_API_PATH+"modacc",data:t,type:"post",beforeSend:function(){e.options.requestState.save=!1},success:function(t){var s=t.rpco;switch(s){case 200:util.href("accsuccess.html");break;case 40001:util.tip(e.options.msg.m11);break;case 40002:util.tip(e.options.msg.m12);break;case 40003:util.tip(e.options.msg.m13);break;case 40004:util.tip(e.options.msg.m14);break;default:util.tip("保存失败")}},complete:function(){e.options.requestState.save=!0}})},save:function(){var t=this,e=t.options.hrefParma.actype,s=$("#acnum").val(),n=$("#vcode").val(),o=t.options.uiqcd;return e?t.options.ACTYPE[e]?s?o?n?void(t.options.requestState.save&&t._save({actype:e,acnum:s,mac:n,uiqcd:o})):(util.tip(t.options.msg.m10),!1):(util.tip(t.options.msg.m9),!1):(util.tip(t.options.msg.m3),!1):(util.tip(t.options.msg.m2),!1):(util.tip(t.options.msg.m1),!1)},cardBindRule:function(){var t="";$(".dialog").remove(),t='<div class="dialog"><div class="tablecell"><div class="dialog-context no-txtidt"><div class="ttl">绑定会员卡<span class="opctbig" id="dialogClose"><i class="i i-delete2"></i></span></div><div class="txt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指绑定国美旗下公司给予用户注册的会员卡，包含国美电器、大中电器、永乐电器等不同国美旗下品牌公司会员卡，目前仅支持绑定线下会员卡。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;为了您的账户信息安全，只能绑定本人持有的会员卡，如绑定非本人会员卡，国美管家接收到用户申述后有权单方面解绑会员卡绑定。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;国美管家将获取您通过会员卡关联的用户、订单、商品等相关信息，国美管家提供对会员卡信息转化为资产、保修管理、电子说明书等服务，并为用户提供根据会员卡信息进行针对性服务。对于用户会员卡信息是否存在缺失及会员卡找回国美管家不承担相关责任与义务。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;会员卡如解绑，会员卡所关联信息将同步移除，由于解绑会员卡造成的损失国美管家不承担相关责任。国美管家不提供会员卡信息找回、密码找回等功能，如遇会员卡遗失等问题请联系办卡单位进行处理，国美管家仅提供会员卡绑定必要验证程序，如由于用户自行丢失会员卡造成会员卡被其它用户绑定，国美管家不承担相关责任，如遇会员卡已被绑定，请及时联系客服进行处理。</div></div></div></div>',$("body").append(t)},addEvent:function(){var t=this,e=util.getClick(),s=t.options.hrefParma;t.el.on(e,"#sendCode",function(){t.sendCodeClick()}),t.el.on(e,"#save",function(){t.save()}),t.el.on(e,"#accsearch",function(t){util.href("accsearch.html",{actype:s.actype})}),t.el.on(e,"#dialogClose",function(){$(".dialog").addClass("dn")}),t.el.on(e,"#cardBindRule",function(){t.cardBindRule()})}});