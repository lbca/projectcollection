/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},AddressList=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),addlist:[],daddr:"",msg:{m1:"删除成功",m2:"是否删除当前地址？",m3:"当前地址已为默认地址",m4:"设置成功"},requestState:{deladdress:!0,setDefault:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(AddressList.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this;t.options.hrefParma;t.getAddressList()},renderAddressList:function(t,s){var e=this,t=t||[],d="";$.each(t,function(t,i){var n=i.cname||"",a=i.cphone||"",o=i.region+" "+i.addr+" "+i.hnum||"",r="";i.tsup===s&&(r="最后使用",e.options.daddr=i.tsup),d+='<li val="'+i.tsup+'"><p>'+n+"&nbsp;&nbsp;&nbsp;&nbsp;"+a+'</p><p class="text-detail">'+o+'</p><span class="setdefault">'+r+'</span><span class="btn-del dn"><i class="i i-delete1"></i></span></li>'}),d&&$("#list").html(d).show()},getAddressList:function(){var t=this;util.api({surl:root.MB_API_PATH+"addrlist",type:"get",beforeSend:function(){util.comShow({txt:"正在努力加载中…",icl:"i-load ro360"})},success:function(s){var e=s.rpco,d=s.body||{},i=d.addlist||[],n=t.options.daddr=d.daddr||"";switch(e){case 200:t.options.addlist=i||[],t.renderAddressList(i,n),$(".menu .js-unBind").show();break;case 404:$("#noList").show();break;default:util.tip("查询失败")}},complete:function(){util.remComShow()}})},_deladdress:function(t){var s=this;util.api({surl:root.MB_API_PATH+"modaddr",data:{tsup:t,state:util.OPT_STATE.DELETE},type:"post",beforeSend:function(){s.options.requestState.deladdress=!1},success:function(t){var s=t.rpco;t.body||{};switch(s){case 200:window.location.reload();break;default:util.tip("删除失败")}},complete:function(){s.options.requestState.deladdress=!0}})},deladdress:function(t){var s=this;util.alert(s.options.msg.m2,{justOk:!1,defBtnIndex:1,okFn:function(){s._deladdress(t)}})},addEvent:function(){var t=this,s=util.getClick();t.options.hrefParma;t.el.on(s,".js-addBind",function(){util.href("areaprovince.html",{cbu:"setaddress.html"})}),t.el.on(s,".js-unBind",function(){$(".btn-del").show(),$(".setdefault").addClass("gray")}),$(".header, .container").on(s,function(t){var s=$(t.target);s.is(".btn-del")||s.is(".js-unBind")||($(".btn-del").hide(),$(".setdefault").removeClass("gray"))}),t.el.on(s,".btn-del",function(){var s=$(this).closest("li").attr("val");s&&t.deladdress(s)})}});