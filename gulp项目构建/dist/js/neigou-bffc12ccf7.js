/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},NeiGou=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),reg:{name:/^[\u4e00-\u9fa5a-zA-Z]+$/,phone:/^(((1[3|8][0-9])|(14[5|7])|(15[^4,\D])|(17[6|7|8]))\d{8}|(170[0|5|9])\d{7})$/},isMod:!0,activeInfo:{regid:"",foi:""},msg:{m1:"姓名未填写",m2:"只能输入汉字和字母",m3:"手机号码未填写",m4:"手机号码格式错误",m5:"手机号已登记",m6:"推荐人编号错误",m7:"报名已截止",m8:"登记成功"},requestState:{save:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(NeiGou.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this;t.options.hrefParma;t.getActiveInfo()},getActiveInfo:function(){var t=this,e=t.options.hrefParma;util.api({surl:root.PURCHASING_API_PATH+"getGcInfo",type:"get",beforeSend:function(){},success:function(i){var o=i.rpco,s=i.body||{};switch(o){case 200:t.options.isMod=!1,$("#view").show(),$("#modify").removeClass("dn");break;case 40005:t.switchModify();break;default:util.tip("查询失败")}t.renderActiveInfo(s),t.getLikeCategory(),e.isMod&&t.switchModify()},complete:function(){}})},renderActiveInfo:function(t){var e,i,o,s=this,n=s.options.hrefParma,a=t.atstate;2==a?util.replace("neigouinfo.html"):(e=n.gname||t.gname||"",$(".js_name").val(e).html(e),i=n.mob||t.mob||"",i+="",i=i.replace(/(\d{3})\d{5}(\d{3})/,"$1*****$2"),$(".js_phone").val(i).html(i),o=n.refid||t.refid||"",$(".js_sendPerson").val(o).html(o),$(".js_areaval").html(n.areafull||t.regtxt||""),s.options.activeInfo.regid=n.d||t.regid,s.options.activeInfo.foi=n.foi||t.foi||"")},getLikeCategory:function(){var t=this;util.api({surl:root.PURCHASING_API_PATH+"getFoi",type:"post",beforeSend:function(){},success:function(e){var i=e.rpco,o=e.body||{};switch(i){case 200:t.renderLikeCategory(o),t.options.activeInfo.foi&&t.selectLikeCategory(t.options.activeInfo.foi);break;case 404:break;default:util.tip("查询失败")}},complete:function(){}})},save:function(){var t,e=this,i=$("#mod .js_name").val(),o=$("#mod .js_phone").val(),s=$("#mod .js_sendPerson").val(),n="",a=e.options.hrefParma.d;return i?e.options.reg.name.test(i)?o?e.options.reg.phone.test(o)?(t={gname:i,mob:o},$("#mod .js_list .sel").each(function(t,e){n+=","+$(this).attr("val")}),n&&(t.foi=n=n.substring(1,n.length)),s&&(t.refid=s),a&&(t.regid=a),void e._save(t)):(util.tip(e.options.msg.m4),!1):(util.tip(e.options.msg.m3),!1):(util.tip(e.options.msg.m2),!1):(util.tip(e.options.msg.m1),!1)},_save:function(t){var e=this;return!!e.options.requestState.save&&void util.api({data:t,surl:root.PURCHASING_API_PATH+"register",type:"post",beforeSend:function(){e.options.requestState.save=!1},success:function(t){var i=t.rpco;t.body||{};switch(i){case 200:util.replace("neigou.html");break;case 40002:util.tip(e.options.msg.m5);break;case 40011:util.tip(e.options.msg.m6);break;case 40012:util.tip(e.options.msg.m7);break;default:util.tip("提交失败")}},complete:function(){e.options.requestState.save=!0}})},renderLikeCategory:function(t){var e=$(".js_list");html="";for(var i=0,o=t.length;i<o;i++)html+='<span class="btn btn-gray tod js_category" val="'+t[i].id+'">'+t[i].name+"</span>";html&&e.html(html),e.width(e.filter(":visible").width()+parseInt($(".js_category").css("margin-right")))},selectLikeCategory:function(t){for(var e=t.split(","),i=0,o=e.length;i<o;i++)$('.js_category[val="'+e[i]+'"]').addClass("sel")},setArea:function(){var t=this,e=$("#mod .js_name").val(),i=$("#mod .js_phone").val(),o=$("#mod .js_sendPerson").val(),s="",n=(t.options.hrefParma.d,{});$("#mod .js_list .sel").each(function(t,e){s+=","+$(this).attr("val")}),e&&(n.gname=e),i&&(n.mob=i),o&&(n.refid=o),s&&(n.foi=s=s.substring(1,s.length)),util.href("neigouprovince.html",n,!0)},switchModify:function(){var t=this;$("#view").hide(),$("#modify").addClass("dn"),$("#mod").show(),$("#save").removeClass("dn"),t.options.isMod=!0},addEvent:function(){var t=this,e=util.getClick();t.options.hrefParma;t.el.on(e,".js_category",function(){t.options.isMod&&$(this).toggleClass("sel")}),t.el.on(e,"#save",function(){t.save()}),t.el.on(e,"#modify",function(){t.switchModify()}),t.el.on(e,"#area",function(){t.options.isMod&&t.setArea()}),$(window).resize(function(){var t=$(".js_list");t.width("100%"),t.width(t.filter(":visible").width()+parseInt($(".js_category").css("margin-right")))})}});