/**
 * yidao
 * created by 用车前端组
 */
"use strict";var WxJointLogin=function t(e){this.wxloginSetting={id:"wxLoginBlock",appid:"",scope:"snsapi_login",redirect_uri:t.DOMAIN_PATH+t.WXCOM_API_PATH+"wxlg",state:"",style:"",href:""},e.id&&(this.wxloginSetting.id=e.id),e.appid&&(this.wxloginSetting.appid=e.appid),e.scope&&(this.wxloginSetting.scope=e.scope),e.redirect_uri&&(this.wxloginSetting.redirect_uri=e.redirect_uri),e.state&&(this.wxloginSetting.state=e.state),e.style&&(this.wxloginSetting.style=e.style),e.href&&(this.wxloginSetting.href=e.href)};WxJointLogin.DOMAIN_PATH=window.location.protocol+"//"+window.location.host,WxJointLogin.BASE_PATH="/",WxJointLogin.API_PATH=WxJointLogin.BASE_PATH+"wxcommon/v1/",WxJointLogin.WXCOM_API_PATH=WxJointLogin.BASE_PATH+"wxcommon/v1/",WxJointLogin.VERSION="1",WxJointLogin.EMP_FUN=function(){},WxJointLogin.prototype.init=function(){var t=this;t.load(),t.addEvent()},WxJointLogin.prototype.load=function(){var t=this;t.getWxJointLoginParma()},WxJointLogin.prototype.getWxJointLoginParma=function(){var t=this,e=WxJointLogin.getHrefParma(),i=e.orginURI||WxJointLogin.DOMAIN_PATH;WxJointLogin.api({url:WxJointLogin.API_PATH+"wxjlgpm",data:{furl:i},type:"post",success:function(e){var i,n=e.rpco;switch(n){case 200:i=e.body||{},t.initWxLogin({appid:i.appid,scope:i.scope,state:i.state})}}})},WxJointLogin.prototype.initWxLogin=function(t){var e=this;t.id&&(e.wxloginSetting.id=t.id),t.appid&&(e.wxloginSetting.appid=t.appid),t.scope&&(e.wxloginSetting.scope=t.scope),t.redirect_uri&&(e.wxloginSetting.redirect_uri=t.redirect_uri),t.state&&(e.wxloginSetting.state=t.state),t.style&&(e.wxloginSetting.style=t.style),t.href&&(e.wxloginSetting.href=t.href),new WxLogin(e.wxloginSetting)},WxJointLogin.prototype.addEvent=function(){WxJointLogin.getClick()},WxJointLogin.getClick=function(){return this.checkSupportTouch()?"tap":"click"},WxJointLogin.checkSupportTouch=function(){return"undefined"!=typeof window.document.ontouchstart},WxJointLogin.getHrefParma=function(t){var e,i,n,o,s={},a=[],r="";t?(e=t.indexOf("?"),t=e>-1?t.slice(e+1):""):t=decodeURI(window.location.search.slice(1)),a=t.split("&");for(var e in a)r=a[e],i=r.indexOf("="),i<0||(n=r.slice(0,i),o=r.slice(i+1),s[n]=o);return s},WxJointLogin.api=function(t){var e,i={url:"",data:{},timeout:5e3,type:"post",async:!1,dataType:"json",contentType:"application/json; charset=utf-8",success:WxJointLogin.EMP_FUN,error:WxJointLogin.EMP_FUN,complete:WxJointLogin.EMP_FUN},n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o=[],s="";if(t.url&&(i.url=t.url),t.data&&(i.data=t.data),t.timeout&&(i.timeout=t.timeout),t.type&&(i.type=t.type),t.async&&(i.async=t.async),t.dataType&&(i.dataType=t.dataType),t.contentType&&(i.contentType=t.contentType),t.success&&(i.success=t.success),t.error&&(i.error=t.error),t.complete&&(i.complete=t.complete),n.onreadystatechange=function(){if(4==n.readyState){if(n.onreadystatechange=WxJointLogin.EMP_FUN,clearTimeout(e),n.status>=200&&n.status<300||304==n.status)try{"json"===i.dataType&&n.responseText&&i.success(JSON.parse(n.responseText))}catch(t){i.error(),console.log("ajax send error...",t)}else i.error();i.complete()}},i.type=i.type.toUpperCase(),"POST"===i.type&&/application\/json;/.test(i.contentType))s=JSON.stringify(i.data);else{for(var a in i.data)i.data.hasOwnProperty(a)&&o.push(a+"="+i.data[a]);s=o.join("&")}"GET"===i.type&&(i.url+=(i.url.indexOf("?")>-1?"&":"?")+s,s=null),i.timeout&&(e=setTimeout(function(){n.onreadystatechange=WxJointLogin.EMP_FUN,n.abort()},i.timeout)),i.url+=(i.url.indexOf("?")>-1?"&":"?")+"ct="+(new Date).getTime(),n.open(i.type,i.url,i.async),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type",i.contentType),n.send(s)};