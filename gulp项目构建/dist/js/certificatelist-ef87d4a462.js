/**
 * yidao
 * created by 用车前端组
 */
"use strict";var root=window||{},util=root.util||{},CertificateList=function(t){this.options=$.extend({sel:"",hrefParma:util.getHrefParma(),ceType:{1:"身份证",2:"户口薄",3:"护照",4:"军官证",5:"士兵证",6:"港澳居民来往内地通行证",7:"台湾同胞来往内地通行证",8:"临时身份证",9:"外国人居留证",10:"警官证"},cetic:{1:"i-shenfenzheng",2:"i-hukoubo",3:"i-huzhao",4:"i-junguan",5:"i-shibingi",6:"i-gangaotongxingzheng",7:"i-taiwan",8:"i-lingshi",9:"i-waiguoren",10:"i-jingguan"},celist:[],msg:{m1:"删除成功",m2:"是否删除当前证件？"},requestState:{deleteCerti:!0}},t),this.sel=this.options.sel,this.el=$(this.sel)};$.extend(CertificateList.prototype,{init:function(){var t=this;t.load(),t.addEvent()},load:function(){var t=this;t.options.hrefParma;t.getCertiList()},renderCertiList:function(t){var e=this,t=t||[],i="",n="",s="",o="",a="",l="",r="";$.each(t,function(t,c){n=c.cetp,s=e.options.ceType[n]||"",o=e.options.cetic[n]||"",a=c.ceno||"",l=c.oname||"",r=c.natly||"",i+='<li val="'+c.tsup+'" cetp="'+n+'"><i class="text-icon i '+o+'"></i><p class="tod">'+s+'<span class="text-smallgray pl5">'+r+'</span></p><p class="text-detail"><span class="text-smallgray">'+l+'</span><span class="text-rt">'+a+'</span></p><span class="btn-del dn"><i class="i i-delete1"></i></span></li>'}),i&&$("#list").html(i).show()},getCertiList:function(){var t=this;util.api({surl:root.MB_API_PATH+"certifilist",type:"get",beforeSend:function(){util.comShow({txt:"正在努力加载中…",icl:"i-load ro360"})},success:function(e){var i=e.rpco,n=e.body||{},s=n.celist||[];switch(i){case 200:t.options.celist=s||[],t.renderCertiList(s),$(".menu .js-unBind").show();break;case 404:$("#noList").show();break;default:util.tip("查询失败")}},complete:function(){util.remComShow()}})},_deleteCerti:function(t,e){var i=this;util.api({surl:root.MB_API_PATH+"modcertifi",data:{tsup:t,cetp:e,state:util.OPT_STATE.DELETE},type:"post",beforeSend:function(){i.options.requestState.deleteCerti=!1},success:function(t){var e=t.rpco;t.body||{};switch(e){case 200:window.location.reload();break;default:util.tip("删除失败")}},complete:function(){i.options.requestState.deleteCerti=!0}})},deleteCerti:function(t,e){var i=this;util.alert(i.options.msg.m2,{justOk:!1,defBtnIndex:1,okFn:function(){i._deleteCerti(t,e)}})},addEvent:function(){var t=this,e=util.getClick();t.options.hrefParma;t.el.on(e,".js-addBind",function(){util.href("certificatetype.html")}),t.el.on(e,".js-unBind",function(){$(".btn-del").show()}),$(".header, .container").on(e,function(t){var e=$(t.target);e.is(".btn-del")||e.is(".js-unBind")||$(".btn-del").hide()}),t.el.on(e,".btn-del",function(){var e=$(this).closest("li"),i=e.attr("val"),n=e.attr("cetp");i&&t.deleteCerti(i,n)})}});