/**
 * yidao
 * created by 用车前端组
 */
"use strict";var Scale=function(t){this.options=$.extend({sel:"",scale:{buffer:.25,oX:0,oY:0,x:0,y:0,oDiffX:0,oDiffY:0,scaNum:0,lastDiff:0}},t),this.el=$(this.options.sel)};$.extend(Scale.prototype,{init:function(){var t=this;t.domEvents()},clearScale:function(){var t=this;t.options.scale.lastDiff=0,t.options.scale.scaNum=1,t.scale(1),t.options.scale.x=0,t.options.scale.y=0,t.translate(0,0)},translate:function(t,e){var s=this;s.options.scale.scaNum||1;s.el.css({position:"relative",left:t+"px",top:e+"px"})},scale:function t(t){var e=this,t=t||1,s="scale("+t+")";e.el.css({"-webkit-transform":s,transform:s})},getMaxX:function(){var t=this,e=t.el.parent().width(),s=t.el.width()-e;return s<0?0:parseInt(s/2)},getMaxY:function(){var t=this,e=t.el.parent().height(),s=t.el.height()-e;return s<0?0:parseInt(s/2)},getDiffX:function(t){var e=t.touches||[],s=0;return e.length>1&&(s=e[0].clientX-e[1].clientX),Math.abs(s)},getDiffY:function(t){var e=t.touches||[],s=0;return e.length>1&&(s=e[0].clientY-e[1].clientY),Math.abs(s)},touchstart:function(t){var e=this,s=t.touches||[];s.length<=1?(e.options.scale.oX=s[0].clientX,e.options.scale.oY=s[0].clientY):(e.options.scale.oDiffX=e.getDiffX(t),e.options.scale.oDiffY=e.getDiffY(t))},touchmove:function(t){var e,s,o,n,a=this,i=t.touches||[],c=a.options.scale.oX,l=a.options.scale.oY,f=i[0].clientX,r=i[0].clientY,h=a.options.scale.x,u=a.options.scale.y,p=a.options.scale.oDiffX,v=a.options.scale.oDiffY,g=a.getDiffX(t),D=a.getDiffY(t),X=g-p,Y=D-v,x=Math.abs(Math.abs(X)<Math.abs(Y)?Y:X),m=a.options.scale.lastDiff,M=a.options.scale.buffer;i.length<=1?(o=a.getMaxX(),n=a.getMaxY(),h=parseInt((f-c)/10+h),u=parseInt((r-l)/10+u),Math.abs(h)>o&&(h=h<0?o*-1:o),Math.abs(u)>n&&(u=u<0?n*-1:n),a.options.scale.x=h,a.options.scale.y=u,a.translate(h,u)):((v<D||p<g)&&(s=!0),x=s?m+x:m-x,x<0&&(e=0),a.options.scale.lastDiff=x,e=parseFloat(.01*x*M).toFixed(1),e<1&&(e=1),e>15&&(e=15),a.options.scale.scaNum=e,a.scale(e))},touchend:function(t){var e=this,s=t.touches||[];e.options.scale.x,e.options.scale.y,e.options.scale.scaNum;s.length<=1},domEvents:function(){var t=this;t.el.on("touchstart",function(e){t.touchstart(e)}),t.el.on("touchmove",function(e){t.touchmove(e)}),t.el.on("touchend",function(e){t.touchend(e)}),setInterval(function(){t.clearScale()},5e3)}});