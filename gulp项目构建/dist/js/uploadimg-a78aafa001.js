/**
 * yidao
 * created by 用车前端组
 */
"use strict";function UploadPic(){this.sw=0,this.sh=0,this.tw=0,this.th=0,this.scale=0,this.maxWidth=0,this.maxHeight=0,this.maxSize=0,this.fileSize=0,this.fileDate=null,this.fileType="",this.fileName="",this.input=null,this.canvas=null,this.mime={},this.type="",this.callback=function(){},this.loading=function(){}}UploadPic.prototype.init=function(t){this.maxWidth=t.maxWidth||960,this.maxHeight=t.maxHeight||720,this.maxSize=t.maxSize||3145728,this.input=t.input,this.mime={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",bmp:"image/bmp"},this.callback=t.callback||function(){},this.loading=t.loading||function(){},this._addEvent()},UploadPic.prototype._addEvent=function(){function t(t){i._handelSelectFile(t)}var i=this;this.input.addEventListener("change",t,!1)},UploadPic.prototype._handelSelectFile=function(t){var i=t.target.files[0];return this.type=i.type,this.type||(this.type=this.mime[i.name.match(/\.([^\.]+)$/i)[1]]),/image.(png|jpg|jpeg|bmp)/.test(this.type)?(this.fileName=i.name,this.fileSize=i.size,this.fileType=this.type,this.fileDate=i.lastModifiedDate,void this._readImage(i)):void alert("只能选择图片")},UploadPic.prototype._readImage=function(t){function i(t){e._createImage(t)}var e=this;this.loading(),this._getURI(t,i)},UploadPic.prototype._getURI=function(t,i){function e(){var t=/^data:base64,/,e=this.result+"";t.test(e)&&(e=e.replace(t,"data:"+s.mime[s.fileType]+";base64,")),i&&i(e)}var h=new FileReader,s=this;return h.onload=e,h.readAsDataURL(t),!1},UploadPic.prototype._createImage=function(t){function i(){h._drawImage(this)}var e=new Image,h=this;e.onload=i,e.src=t},UploadPic.prototype._drawImage=function(t,i){this.sw=t.width,this.sh=t.height,this.tw=t.width,this.th=t.height,this.scale=(this.tw/this.th).toFixed(2),this.sw>this.maxWidth&&(this.sw=this.maxWidth,this.sh=Math.round(this.sw/this.scale)),this.sh>this.maxHeight&&(this.sh=this.maxHeight,this.sw=Math.round(this.sh*this.scale)),this.canvas=document.createElement("canvas");var e=this.canvas.getContext("2d");this.canvas.width=this.sw,this.canvas.height=this.sh,e.drawImage(t,0,0,t.width,t.height,0,0,this.sw,this.sh),this.callback(this.canvas.toDataURL(this.type)),e.clearRect(0,0,this.tw,this.th),this.canvas.width=0,this.canvas.height=0,this.canvas=null};